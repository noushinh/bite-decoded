{"ast":null,"code":"import React,{useRef,useEffect}from'react';import L from'leaflet';import'leaflet/dist/leaflet.css';// (No dynamic loaders needed — Leaflet is imported from npm)\nimport{jsx as _jsx}from\"react/jsx-runtime\";export default function Map(_ref){let{locations=[],selectedLocation=null}=_ref;const mapContainer=useRef(null);const mapRef=useRef(null);const markersRef=useRef([]);useEffect(()=>{// Always initialize Leaflet for the map panel\ntry{const map=L.map(mapContainer.current,{scrollWheelZoom:true}).setView([20,0],2);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'&copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors'}).addTo(map);mapRef.current=map;// add a small scale control\ntry{L.control.scale({position:'bottomleft',imperial:false}).addTo(map);}catch(e){/* ignore */}// ensure proper sizing when inside flex containers\nconst ensureSize=()=>{try{map.invalidateSize&&map.invalidateSize();}catch(e){}};ensureSize();const _t1=setTimeout(ensureSize,100);const _t2=setTimeout(ensureSize,500);const _t3=setTimeout(ensureSize,1000);const onResize=()=>ensureSize();window.addEventListener('resize',onResize);// debug\n// eslint-disable-next-line no-console\nconsole.log('Leaflet initialized — scheduled invalidateSize retries');return()=>{try{window.removeEventListener('resize',onResize);}catch(e){}clearTimeout(_t1);clearTimeout(_t2);clearTimeout(_t3);try{map.remove();}catch(e){}mapRef.current=null;};}catch(e){// eslint-disable-next-line no-console\nconsole.warn('Leaflet init failed:',e);return undefined;}},[]);// Update markers (Leaflet)\nuseEffect(()=>{const map=mapRef.current;if(!map)return;// remove existing marker layers\nmarkersRef.current.forEach(m=>{try{map.removeLayer(m);}catch(e){}});markersRef.current=[];locations.forEach(loc=>{try{const m=L.circleMarker([loc.coordinates[1],loc.coordinates[0]],{radius:6,color:'#2a9df4',fillOpacity:0.9}).addTo(map);m.bindPopup(\"<strong>\".concat(loc.title,\"</strong><br/>\").concat(loc.description));markersRef.current.push(m);}catch(e){// ignore\n}});// if we added any markers, fit the map to their bounds for a good initial view\ntry{if(markersRef.current.length>0){const group=L.featureGroup(markersRef.current);map.fitBounds(group.getBounds().pad(0.25),{animate:true});}else{// no markers: show a world view\nmap.setView([20,0],2);}}catch(e){/* ignore fit errors */}},[locations]);// Handle selection: open popup and set view\nuseEffect(()=>{if(!selectedLocation)return;const map=mapRef.current;if(!map)return;const[lng,lat]=selectedLocation.coordinates;map.setView([lat,lng],14);const matched=markersRef.current.find(m=>{try{const latlng=m.getLatLng();return Math.abs(latlng.lng-lng)<1e-6&&Math.abs(latlng.lat-lat)<1e-6;}catch(e){return false;}});if(matched&&matched.openPopup)matched.openPopup();},[selectedLocation]);return/*#__PURE__*/_jsx(\"div\",{style:{position:'relative',height:'100%'},children:/*#__PURE__*/_jsx(\"div\",{ref:mapContainer,id:\"map\",className:\"map\",style:{height:'100%'}})});}","map":{"version":3,"names":["React","useRef","useEffect","L","jsx","_jsx","Map","_ref","locations","selectedLocation","mapContainer","mapRef","markersRef","map","current","scrollWheelZoom","setView","tileLayer","maxZoom","attribution","addTo","control","scale","position","imperial","e","ensureSize","invalidateSize","_t1","setTimeout","_t2","_t3","onResize","window","addEventListener","console","log","removeEventListener","clearTimeout","remove","warn","undefined","forEach","m","removeLayer","loc","circleMarker","coordinates","radius","color","fillOpacity","bindPopup","concat","title","description","push","length","group","featureGroup","fitBounds","getBounds","pad","animate","lng","lat","matched","find","latlng","getLatLng","Math","abs","openPopup","style","height","children","ref","id","className"],"sources":["/Users/noushinhaque/foodies/src/components/Map.js"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\n// (No dynamic loaders needed — Leaflet is imported from npm)\n\nexport default function Map({ locations = [], selectedLocation = null }) {\n  const mapContainer = useRef(null);\n  const mapRef = useRef(null);\n  const markersRef = useRef([]);\n\n  useEffect(() => {\n    // Always initialize Leaflet for the map panel\n    try {\n      const map = L.map(mapContainer.current, { scrollWheelZoom: true }).setView([20, 0], 2);\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        maxZoom: 19,\n        attribution: '&copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors',\n      }).addTo(map);\n\n      mapRef.current = map;\n\n      // add a small scale control\n      try { L.control.scale({ position: 'bottomleft', imperial: false }).addTo(map); } catch (e) { /* ignore */ }\n\n      // ensure proper sizing when inside flex containers\n      const ensureSize = () => { try { map.invalidateSize && map.invalidateSize(); } catch (e) {} };\n      ensureSize();\n      const _t1 = setTimeout(ensureSize, 100);\n      const _t2 = setTimeout(ensureSize, 500);\n      const _t3 = setTimeout(ensureSize, 1000);\n      const onResize = () => ensureSize();\n      window.addEventListener('resize', onResize);\n\n      // debug\n      // eslint-disable-next-line no-console\n      console.log('Leaflet initialized — scheduled invalidateSize retries');\n\n      return () => {\n        try { window.removeEventListener('resize', onResize); } catch(e){}\n        clearTimeout(_t1); clearTimeout(_t2); clearTimeout(_t3);\n        try{ map.remove(); }catch(e){}\n        mapRef.current = null;\n      };\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn('Leaflet init failed:', e);\n      return undefined;\n    }\n  }, []);\n\n  // Update markers (Leaflet)\n  useEffect(() => {\n    const map = mapRef.current;\n    if (!map) return;\n\n    // remove existing marker layers\n    markersRef.current.forEach((m) => { try { map.removeLayer(m); } catch(e) {} });\n    markersRef.current = [];\n\n    locations.forEach((loc) => {\n      try {\n        const m = L.circleMarker([loc.coordinates[1], loc.coordinates[0]], { radius: 6, color: '#2a9df4', fillOpacity: 0.9 }).addTo(map);\n        m.bindPopup(`<strong>${loc.title}</strong><br/>${loc.description}`);\n        markersRef.current.push(m);\n      } catch (e) {\n        // ignore\n      }\n    });\n\n    // if we added any markers, fit the map to their bounds for a good initial view\n    try {\n      if (markersRef.current.length > 0) {\n        const group = L.featureGroup(markersRef.current);\n        map.fitBounds(group.getBounds().pad(0.25), { animate: true });\n      } else {\n        // no markers: show a world view\n        map.setView([20, 0], 2);\n      }\n    } catch (e) { /* ignore fit errors */ }\n  }, [locations]);\n\n  // Handle selection: open popup and set view\n  useEffect(() => {\n    if (!selectedLocation) return;\n    const map = mapRef.current;\n    if (!map) return;\n    const [lng, lat] = selectedLocation.coordinates;\n    map.setView([lat, lng], 14);\n    const matched = markersRef.current.find((m) => {\n      try { const latlng = m.getLatLng(); return Math.abs(latlng.lng - lng) < 1e-6 && Math.abs(latlng.lat - lat) < 1e-6; } catch(e) { return false; }\n    });\n    if (matched && matched.openPopup) matched.openPopup();\n  }, [selectedLocation]);\n\n  return (\n    <div style={{ position: 'relative', height: '100%' }}>\n      <div ref={mapContainer} id=\"map\" className=\"map\" style={{ height: '100%' }} />\n    </div>\n  );\n}\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,MAAM,CAAEC,SAAS,KAAQ,OAAO,CAChD,MAAO,CAAAC,CAAC,KAAM,SAAS,CACvB,MAAO,0BAA0B,CAEjC;AAAA,OAAAC,GAAA,IAAAC,IAAA,yBAEA,cAAe,SAAS,CAAAC,GAAGA,CAAAC,IAAA,CAA8C,IAA7C,CAAEC,SAAS,CAAG,EAAE,CAAEC,gBAAgB,CAAG,IAAK,CAAC,CAAAF,IAAA,CACrE,KAAM,CAAAG,YAAY,CAAGT,MAAM,CAAC,IAAI,CAAC,CACjC,KAAM,CAAAU,MAAM,CAAGV,MAAM,CAAC,IAAI,CAAC,CAC3B,KAAM,CAAAW,UAAU,CAAGX,MAAM,CAAC,EAAE,CAAC,CAE7BC,SAAS,CAAC,IAAM,CACd;AACA,GAAI,CACF,KAAM,CAAAW,GAAG,CAAGV,CAAC,CAACU,GAAG,CAACH,YAAY,CAACI,OAAO,CAAE,CAAEC,eAAe,CAAE,IAAK,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,EAAE,CAAE,CAAC,CAAC,CAAE,CAAC,CAAC,CACtFb,CAAC,CAACc,SAAS,CAAC,oDAAoD,CAAE,CAChEC,OAAO,CAAE,EAAE,CACXC,WAAW,CAAE,gFACf,CAAC,CAAC,CAACC,KAAK,CAACP,GAAG,CAAC,CAEbF,MAAM,CAACG,OAAO,CAAGD,GAAG,CAEpB;AACA,GAAI,CAAEV,CAAC,CAACkB,OAAO,CAACC,KAAK,CAAC,CAAEC,QAAQ,CAAE,YAAY,CAAEC,QAAQ,CAAE,KAAM,CAAC,CAAC,CAACJ,KAAK,CAACP,GAAG,CAAC,CAAE,CAAE,MAAOY,CAAC,CAAE,CAAE,aAE7F;AACA,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAM,CAAE,GAAI,CAAEb,GAAG,CAACc,cAAc,EAAId,GAAG,CAACc,cAAc,CAAC,CAAC,CAAE,CAAE,MAAOF,CAAC,CAAE,CAAC,CAAE,CAAC,CAC7FC,UAAU,CAAC,CAAC,CACZ,KAAM,CAAAE,GAAG,CAAGC,UAAU,CAACH,UAAU,CAAE,GAAG,CAAC,CACvC,KAAM,CAAAI,GAAG,CAAGD,UAAU,CAACH,UAAU,CAAE,GAAG,CAAC,CACvC,KAAM,CAAAK,GAAG,CAAGF,UAAU,CAACH,UAAU,CAAE,IAAI,CAAC,CACxC,KAAM,CAAAM,QAAQ,CAAGA,CAAA,GAAMN,UAAU,CAAC,CAAC,CACnCO,MAAM,CAACC,gBAAgB,CAAC,QAAQ,CAAEF,QAAQ,CAAC,CAE3C;AACA;AACAG,OAAO,CAACC,GAAG,CAAC,wDAAwD,CAAC,CAErE,MAAO,IAAM,CACX,GAAI,CAAEH,MAAM,CAACI,mBAAmB,CAAC,QAAQ,CAAEL,QAAQ,CAAC,CAAE,CAAE,MAAMP,CAAC,CAAC,CAAC,CACjEa,YAAY,CAACV,GAAG,CAAC,CAAEU,YAAY,CAACR,GAAG,CAAC,CAAEQ,YAAY,CAACP,GAAG,CAAC,CACvD,GAAG,CAAElB,GAAG,CAAC0B,MAAM,CAAC,CAAC,CAAE,CAAC,MAAMd,CAAC,CAAC,CAAC,CAC7Bd,MAAM,CAACG,OAAO,CAAG,IAAI,CACvB,CAAC,CACH,CAAE,MAAOW,CAAC,CAAE,CACV;AACAU,OAAO,CAACK,IAAI,CAAC,sBAAsB,CAAEf,CAAC,CAAC,CACvC,MAAO,CAAAgB,SAAS,CAClB,CACF,CAAC,CAAE,EAAE,CAAC,CAEN;AACAvC,SAAS,CAAC,IAAM,CACd,KAAM,CAAAW,GAAG,CAAGF,MAAM,CAACG,OAAO,CAC1B,GAAI,CAACD,GAAG,CAAE,OAEV;AACAD,UAAU,CAACE,OAAO,CAAC4B,OAAO,CAAEC,CAAC,EAAK,CAAE,GAAI,CAAE9B,GAAG,CAAC+B,WAAW,CAACD,CAAC,CAAC,CAAE,CAAE,MAAMlB,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC,CAC9Eb,UAAU,CAACE,OAAO,CAAG,EAAE,CAEvBN,SAAS,CAACkC,OAAO,CAAEG,GAAG,EAAK,CACzB,GAAI,CACF,KAAM,CAAAF,CAAC,CAAGxC,CAAC,CAAC2C,YAAY,CAAC,CAACD,GAAG,CAACE,WAAW,CAAC,CAAC,CAAC,CAAEF,GAAG,CAACE,WAAW,CAAC,CAAC,CAAC,CAAC,CAAE,CAAEC,MAAM,CAAE,CAAC,CAAEC,KAAK,CAAE,SAAS,CAAEC,WAAW,CAAE,GAAI,CAAC,CAAC,CAAC9B,KAAK,CAACP,GAAG,CAAC,CAChI8B,CAAC,CAACQ,SAAS,YAAAC,MAAA,CAAYP,GAAG,CAACQ,KAAK,mBAAAD,MAAA,CAAiBP,GAAG,CAACS,WAAW,CAAE,CAAC,CACnE1C,UAAU,CAACE,OAAO,CAACyC,IAAI,CAACZ,CAAC,CAAC,CAC5B,CAAE,MAAOlB,CAAC,CAAE,CACV;AAAA,CAEJ,CAAC,CAAC,CAEF;AACA,GAAI,CACF,GAAIb,UAAU,CAACE,OAAO,CAAC0C,MAAM,CAAG,CAAC,CAAE,CACjC,KAAM,CAAAC,KAAK,CAAGtD,CAAC,CAACuD,YAAY,CAAC9C,UAAU,CAACE,OAAO,CAAC,CAChDD,GAAG,CAAC8C,SAAS,CAACF,KAAK,CAACG,SAAS,CAAC,CAAC,CAACC,GAAG,CAAC,IAAI,CAAC,CAAE,CAAEC,OAAO,CAAE,IAAK,CAAC,CAAC,CAC/D,CAAC,IAAM,CACL;AACAjD,GAAG,CAACG,OAAO,CAAC,CAAC,EAAE,CAAE,CAAC,CAAC,CAAE,CAAC,CAAC,CACzB,CACF,CAAE,MAAOS,CAAC,CAAE,CAAE,wBAChB,CAAC,CAAE,CAACjB,SAAS,CAAC,CAAC,CAEf;AACAN,SAAS,CAAC,IAAM,CACd,GAAI,CAACO,gBAAgB,CAAE,OACvB,KAAM,CAAAI,GAAG,CAAGF,MAAM,CAACG,OAAO,CAC1B,GAAI,CAACD,GAAG,CAAE,OACV,KAAM,CAACkD,GAAG,CAAEC,GAAG,CAAC,CAAGvD,gBAAgB,CAACsC,WAAW,CAC/ClC,GAAG,CAACG,OAAO,CAAC,CAACgD,GAAG,CAAED,GAAG,CAAC,CAAE,EAAE,CAAC,CAC3B,KAAM,CAAAE,OAAO,CAAGrD,UAAU,CAACE,OAAO,CAACoD,IAAI,CAAEvB,CAAC,EAAK,CAC7C,GAAI,CAAE,KAAM,CAAAwB,MAAM,CAAGxB,CAAC,CAACyB,SAAS,CAAC,CAAC,CAAE,MAAO,CAAAC,IAAI,CAACC,GAAG,CAACH,MAAM,CAACJ,GAAG,CAAGA,GAAG,CAAC,CAAG,IAAI,EAAIM,IAAI,CAACC,GAAG,CAACH,MAAM,CAACH,GAAG,CAAGA,GAAG,CAAC,CAAG,IAAI,CAAE,CAAE,MAAMvC,CAAC,CAAE,CAAE,MAAO,MAAK,CAAE,CAChJ,CAAC,CAAC,CACF,GAAIwC,OAAO,EAAIA,OAAO,CAACM,SAAS,CAAEN,OAAO,CAACM,SAAS,CAAC,CAAC,CACvD,CAAC,CAAE,CAAC9D,gBAAgB,CAAC,CAAC,CAEtB,mBACEJ,IAAA,QAAKmE,KAAK,CAAE,CAAEjD,QAAQ,CAAE,UAAU,CAAEkD,MAAM,CAAE,MAAO,CAAE,CAAAC,QAAA,cACnDrE,IAAA,QAAKsE,GAAG,CAAEjE,YAAa,CAACkE,EAAE,CAAC,KAAK,CAACC,SAAS,CAAC,KAAK,CAACL,KAAK,CAAE,CAAEC,MAAM,CAAE,MAAO,CAAE,CAAE,CAAC,CAC3E,CAAC,CAEV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}