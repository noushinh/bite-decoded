{"ast":null,"code":"import React,{useRef,useEffect}from'react';import L from'leaflet';import'leaflet/dist/leaflet.css';// (No dynamic loaders needed — Leaflet is imported from npm)\nimport{jsx as _jsx}from\"react/jsx-runtime\";export default function Map(_ref){let{locations=[],selectedLocation=null}=_ref;const mapContainer=useRef(null);const mapRef=useRef(null);const markersRef=useRef([]);useEffect(()=>{let cancelled=false;let tries=0;const initLeaflet=()=>{if(cancelled)return;const container=mapContainer.current;if(!container){if(tries++<20)return setTimeout(initLeaflet,100);// eslint-disable-next-line no-console\nconsole.warn('Leaflet: map container not found after retries');return;}const{clientWidth,clientHeight}=container;if(!clientWidth||!clientHeight){if(tries++<20)return setTimeout(initLeaflet,100);// eslint-disable-next-line no-console\nconsole.warn('Leaflet: map container has zero size after retries',clientWidth,clientHeight);// we'll proceed anyway\n}try{const map=L.map(container,{scrollWheelZoom:true}).setView([20,0],2);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'&copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors'}).addTo(map);mapRef.current=map;try{L.control.scale({position:'bottomleft',imperial:false}).addTo(map);}catch(e){}const ensureSize=()=>{try{map.invalidateSize&&map.invalidateSize();}catch(e){}};ensureSize();const _t1=setTimeout(ensureSize,100);const _t2=setTimeout(ensureSize,500);const _t3=setTimeout(ensureSize,1000);const _t4=setTimeout(ensureSize,2000);const _t5=setTimeout(ensureSize,4000);const onResize=()=>ensureSize();window.addEventListener('resize',onResize);// expose for debugging in dev console\n// eslint-disable-next-line no-console\nconsole.log('Leaflet initialized',{clientWidth,clientHeight});// add a visible debug background to the container while tiles load\ntry{container.classList.add('debug-bg');}catch(e){}// @ts-ignore\nif(typeof window!=='undefined')window.__LEAFLET_MAP__=map;return()=>{try{window.removeEventListener('resize',onResize);}catch(e){}clearTimeout(_t1);clearTimeout(_t2);clearTimeout(_t3);clearTimeout(_t4);clearTimeout(_t5);try{map.remove();}catch(e){}try{container.classList.remove('debug-bg');}catch(e){}mapRef.current=null;};}catch(e){// eslint-disable-next-line no-console\nconsole.warn('Leaflet init failed:',e);}};initLeaflet();return()=>{cancelled=true;};},[]);// Update markers (Leaflet)\nuseEffect(()=>{const map=mapRef.current;if(!map)return;// remove existing marker layers\nmarkersRef.current.forEach(m=>{try{map.removeLayer(m);}catch(e){}});markersRef.current=[];locations.forEach(loc=>{try{const m=L.circleMarker([loc.coordinates[1],loc.coordinates[0]],{radius:6,color:'#2a9df4',fillOpacity:0.9}).addTo(map);m.bindPopup(\"<strong>\".concat(loc.title,\"</strong><br/>\").concat(loc.description));markersRef.current.push(m);}catch(e){// ignore\n}});// if we added any markers, fit the map to their bounds for a good initial view\ntry{if(markersRef.current.length>0){const group=L.featureGroup(markersRef.current);map.fitBounds(group.getBounds().pad(0.25),{animate:true});}else{// no markers: show a world view\nmap.setView([20,0],2);}}catch(e){/* ignore fit errors */}},[locations]);// Handle selection: open popup and set view\nuseEffect(()=>{if(!selectedLocation)return;const map=mapRef.current;if(!map)return;const[lng,lat]=selectedLocation.coordinates;map.setView([lat,lng],14);const matched=markersRef.current.find(m=>{try{const latlng=m.getLatLng();return Math.abs(latlng.lng-lng)<1e-6&&Math.abs(latlng.lat-lat)<1e-6;}catch(e){return false;}});if(matched&&matched.openPopup)matched.openPopup();},[selectedLocation]);return/*#__PURE__*/_jsx(\"div\",{style:{position:'relative',height:'100%'},children:/*#__PURE__*/_jsx(\"div\",{ref:mapContainer,id:\"map\",className:\"map\",style:{height:'100%'}})});}","map":{"version":3,"names":["React","useRef","useEffect","L","jsx","_jsx","Map","_ref","locations","selectedLocation","mapContainer","mapRef","markersRef","cancelled","tries","initLeaflet","container","current","setTimeout","console","warn","clientWidth","clientHeight","map","scrollWheelZoom","setView","tileLayer","maxZoom","attribution","addTo","control","scale","position","imperial","e","ensureSize","invalidateSize","_t1","_t2","_t3","_t4","_t5","onResize","window","addEventListener","log","classList","add","__LEAFLET_MAP__","removeEventListener","clearTimeout","remove","forEach","m","removeLayer","loc","circleMarker","coordinates","radius","color","fillOpacity","bindPopup","concat","title","description","push","length","group","featureGroup","fitBounds","getBounds","pad","animate","lng","lat","matched","find","latlng","getLatLng","Math","abs","openPopup","style","height","children","ref","id","className"],"sources":["/Users/noushinhaque/foodies/src/components/Map.js"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\n// (No dynamic loaders needed — Leaflet is imported from npm)\n\nexport default function Map({ locations = [], selectedLocation = null }) {\n  const mapContainer = useRef(null);\n  const mapRef = useRef(null);\n  const markersRef = useRef([]);\n\n    useEffect(() => {\n      let cancelled = false;\n      let tries = 0;\n\n      const initLeaflet = () => {\n        if (cancelled) return;\n        const container = mapContainer.current;\n        if (!container) {\n          if (tries++ < 20) return setTimeout(initLeaflet, 100);\n          // eslint-disable-next-line no-console\n          console.warn('Leaflet: map container not found after retries');\n          return;\n        }\n\n        const { clientWidth, clientHeight } = container;\n        if (!clientWidth || !clientHeight) {\n          if (tries++ < 20) return setTimeout(initLeaflet, 100);\n          // eslint-disable-next-line no-console\n          console.warn('Leaflet: map container has zero size after retries', clientWidth, clientHeight);\n          // we'll proceed anyway\n        }\n\n        try {\n          const map = L.map(container, { scrollWheelZoom: true }).setView([20, 0], 2);\n          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n            maxZoom: 19,\n            attribution: '&copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors',\n          }).addTo(map);\n\n          mapRef.current = map;\n\n          try { L.control.scale({ position: 'bottomleft', imperial: false }).addTo(map); } catch (e) {}\n\n          const ensureSize = () => { try { map.invalidateSize && map.invalidateSize(); } catch (e) {} };\n          ensureSize();\n          const _t1 = setTimeout(ensureSize, 100);\n          const _t2 = setTimeout(ensureSize, 500);\n          const _t3 = setTimeout(ensureSize, 1000);\n          const _t4 = setTimeout(ensureSize, 2000);\n          const _t5 = setTimeout(ensureSize, 4000);\n          const onResize = () => ensureSize();\n          window.addEventListener('resize', onResize);\n\n          // expose for debugging in dev console\n          // eslint-disable-next-line no-console\n          console.log('Leaflet initialized', { clientWidth, clientHeight });\n          // add a visible debug background to the container while tiles load\n          try { container.classList.add('debug-bg'); } catch (e) {}\n          // @ts-ignore\n          if (typeof window !== 'undefined') window.__LEAFLET_MAP__ = map;\n\n          return () => {\n            try { window.removeEventListener('resize', onResize); } catch (e) {}\n            clearTimeout(_t1); clearTimeout(_t2); clearTimeout(_t3); clearTimeout(_t4); clearTimeout(_t5);\n            try { map.remove(); } catch (e) {}\n            try { container.classList.remove('debug-bg'); } catch (e) {}\n            mapRef.current = null;\n          };\n        } catch (e) {\n          // eslint-disable-next-line no-console\n          console.warn('Leaflet init failed:', e);\n        }\n      };\n\n      initLeaflet();\n\n      return () => { cancelled = true; };\n    }, []);\n\n  // Update markers (Leaflet)\n  useEffect(() => {\n    const map = mapRef.current;\n    if (!map) return;\n\n    // remove existing marker layers\n    markersRef.current.forEach((m) => { try { map.removeLayer(m); } catch(e) {} });\n    markersRef.current = [];\n\n    locations.forEach((loc) => {\n      try {\n        const m = L.circleMarker([loc.coordinates[1], loc.coordinates[0]], { radius: 6, color: '#2a9df4', fillOpacity: 0.9 }).addTo(map);\n        m.bindPopup(`<strong>${loc.title}</strong><br/>${loc.description}`);\n        markersRef.current.push(m);\n      } catch (e) {\n        // ignore\n      }\n    });\n\n    // if we added any markers, fit the map to their bounds for a good initial view\n    try {\n      if (markersRef.current.length > 0) {\n        const group = L.featureGroup(markersRef.current);\n        map.fitBounds(group.getBounds().pad(0.25), { animate: true });\n      } else {\n        // no markers: show a world view\n        map.setView([20, 0], 2);\n      }\n    } catch (e) { /* ignore fit errors */ }\n  }, [locations]);\n\n  // Handle selection: open popup and set view\n  useEffect(() => {\n    if (!selectedLocation) return;\n    const map = mapRef.current;\n    if (!map) return;\n    const [lng, lat] = selectedLocation.coordinates;\n    map.setView([lat, lng], 14);\n    const matched = markersRef.current.find((m) => {\n      try { const latlng = m.getLatLng(); return Math.abs(latlng.lng - lng) < 1e-6 && Math.abs(latlng.lat - lat) < 1e-6; } catch(e) { return false; }\n    });\n    if (matched && matched.openPopup) matched.openPopup();\n  }, [selectedLocation]);\n\n  return (\n    <div style={{ position: 'relative', height: '100%' }}>\n      <div ref={mapContainer} id=\"map\" className=\"map\" style={{ height: '100%' }} />\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}